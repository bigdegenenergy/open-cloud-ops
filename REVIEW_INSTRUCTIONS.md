# ⚠️ REVIEW INSTRUCTIONS

> Generated by Gemini

```json
{
  "review": {
    "summary": "The PR contains critical issues that prevent merging. Most notably, the lockfiles reference hallucinated/future versions of dependencies (Vite 7, React 19.2) which will cause immediate build failures. Functionally, the Cerebra proxy contains a critical bypass where streaming requests (SSE) completely skip budget enforcement. Several security vulnerabilities exist regarding shell injection in CI workflows and accidental commits of temporary artifacts.",
    "decision": "REQUEST_CHANGES"
  },
  "issues": [
    {
      "id": 1,
      "severity": "critical",
      "file": "package-lock.json",
      "line": 1,
      "title": "Hallucinated Dependency Versions",
      "description": "The lockfile references non-existent future versions of major packages (`vite@7.3.1`, `react@19.2.4`, `typescript@5.9.3`). These versions do not exist on public registries. This renders the project unbuildable and poses a security risk (Dependency Confusion) if these version numbers are claimed by attackers.",
      "suggestion": "Delete `package-lock.json` and run `npm install` to generate a valid lockfile with actual, existing versions."
    },
    {
      "id": 2,
      "severity": "critical",
      "file": "cerebra/internal/proxy/handler.go",
      "line": 180,
      "title": "Budget Enforcement Bypass via Streaming",
      "description": "The `streamResponse` handler explicitly skips cost calculation and calls to `enforcer.RecordSpend`. This creates a loophole allowing users to bypass all budget limits by using streaming APIs (the primary mode for LLMs), rendering the budget enforcement feature ineffective.",
      "suggestion": "Implement token counting for streams (e.g., by accumulating chunks or using an approximation) and ensure cost is recorded after the stream completes."
    },
    {
      "id": 3,
      "severity": "critical",
      "file": ".github/workflows/combined-pr-review.yml",
      "line": 45,
      "title": "Shell Injection Vulnerability in Workflow",
      "description": "The workflow interpolates user input directly into a shell command: `git fetch origin ${{ github.event.pull_request.head.ref }}`. A malicious branch name could execute arbitrary code in the runner context.",
      "suggestion": "Map the untrusted input to an environment variable (e.g., `env: HEAD_REF: ${{ ... }}`) and use the environment variable in the run script (`git fetch origin \"$HEAD_REF\"`)."
    },
    {
      "id": 4,
      "severity": "important",
      "file": "tools/onefilellm/tmp/tmp.EDsqM7tzY4/tools/onefilellm/README.md",
      "line": 1,
      "title": "Accidental Commit of Temporary Artifacts",
      "description": "Temporary build artifacts and deeply nested temporary directories (`tmp/tmp.EDsqM7tzY4/...`) have been committed to the repository.",
      "suggestion": "Remove the `tools/onefilellm/tmp` directory and update `.gitignore` to exclude `tmp/` directories."
    },
    {
      "id": 5,
      "severity": "important",
      "file": "cerebra/internal/budget/enforcer.go",
      "line": 50,
      "title": "Potential Double Counting of Spend",
      "description": "The summary states `CheckBudget` uses a Lua script to 'check and increment' (reservation model). `RecordSpend` also appears to add to the spend. If both are called for the same request, costs will be double-counted.",
      "suggestion": "Verify logic: If `CheckBudget` reserves funds, `RecordSpend` should be a settlement/adjustment operation, or `CheckBudget` should be read-only."
    },
    {
      "id": 6,
      "severity": "important",
      "file": "docs/ANTHROPIC-MODELS.md",
      "line": 10,
      "title": "Configuration References Non-Existent Models",
      "description": "Configuration files and docs reference `claude-opus-4-5-20251101`. This model ID is invalid and will likely cause API errors if used.",
      "suggestion": "Update configurations to use currently available model IDs."
    },
    {
      "id": 7,
      "severity": "suggestion",
      "file": "cerebra/internal/config/config.go",
      "line": 45,
      "title": "DSN Leaks Credentials",
      "description": "The `DSN()` method returns the connection string with the password in cleartext. If this is logged by the application or an ORM, it will leak credentials.",
      "suggestion": "Ensure this value is never logged, or provide a `RedactedDSN()` method for logging purposes."
    }
  ]
}
```