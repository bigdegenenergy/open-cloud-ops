# ⚠️ REVIEW INSTRUCTIONS

> Generated by Gemini

```json
{
  "review": {
    "summary": "The PR implements a massive feature set with high architectural quality, but contains critical security vulnerabilities (timing attacks, command injection) and significant stability risks (OOM in backup logic) that require immediate remediation.",
    "decision": "REQUEST_CHANGES"
  },
  "issues": [
    {
      "id": 1,
      "severity": "critical",
      "file": "cerebra/internal/middleware/middleware.go",
      "line": 0,
      "title": "Variable-time API Key comparison",
      "description": "The AuthMiddleware compares SHA-256 hashes using standard inequality operators (`storedHash != keyHash`). This is vulnerable to timing attacks, allowing an attacker to reconstruct the valid hash byte-by-byte by measuring response times.",
      "suggestion": "Use `crypto/subtle.ConstantTimeCompare` for all sensitive credential comparisons."
    },
    {
      "id": 2,
      "severity": "important",
      "file": "aegis/internal/backup/manager.go",
      "line": 0,
      "title": "OOM risk in backup archiving",
      "description": "The `createArchive` function utilizes `io.ReadAll` to load the entire backup archive into a byte slice before processing. For Kubernetes clusters with significant resource counts or large secrets/configmaps, this will lead to Out-Of-Memory (OOM) crashes of the Aegis service.",
      "suggestion": "Refactor the backup pipeline to use `io.Pipe` or stream directly to the storage backend using `io.Writer` interfaces instead of buffering the entire archive in memory."
    },
    {
      "id": 3,
      "severity": "critical",
      "file": ".claude/workflows/lobster/engine.py",
      "line": 0,
      "title": "Shell Command Injection in Workflow Engine",
      "description": "The engine uses `subprocess.run(..., shell=True)` and performs manual string replacement for variables `{{ var }}`. If a workflow definition uses variables sourced from external inputs (like PR titles or chat messages), an attacker can execute arbitrary commands on the runner environment.",
      "suggestion": "Avoid `shell=True`. Pass arguments as a list and use `shlex.split` for command parsing, or ensure that all variable interpolation is strictly sanitized/validated against a whitelist before execution."
    },
    {
      "id": 4,
      "severity": "important",
      "file": "cerebra/internal/proxy/handler.go",
      "line": 0,
      "title": "Potential data loss in asynchronous logging",
      "description": "Request metadata is logged asynchronously via `go h.logRequest(reqCtx)`. If the Cerebra process crashes or is restarted immediately after a proxy response but before the goroutine completes, billing and audit data for that request will be lost.",
      "suggestion": "Use a buffered channel and a worker pool with a graceful shutdown handler that flushes the channel, or log synchronously if data integrity for billing is a hard requirement."
    },
    {
      "id": 5,
      "severity": "suggestion",
      "file": "economist/pkg/cost/calculator.py",
      "line": 0,
      "title": "Static exchange rates in financial calculations",
      "description": "The calculator uses a static dictionary for currency exchange rates. In a FinOps context, this will lead to increasingly inaccurate reports as market conditions change.",
      "suggestion": "Implement a caching provider that fetches daily rates from a reliable source (e.g., Fixer.io or Open Exchange Rates) with a fallback to the static registry."
    },
    {
      "id": 6,
      "severity": "important",
      "file": "deploy/docker/docker-compose.yml",
      "line": 0,
      "title": "Hardcoded default credentials in deployment",
      "description": "The compose file contains hardcoded passwords like 'change_me_to_a_strong_password'. While useful for dev, these often leak into production environments if not strictly gated.",
      "suggestion": "Remove default password values and force the use of an `.env` file that is listed in `.gitignore`, or use Docker Secrets."
    }
  ]
}
```