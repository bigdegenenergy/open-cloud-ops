# ⚠️ REVIEW INSTRUCTIONS

> Generated by Gemini

```json
{
  "review": {
    "summary": "Massive, high-quality PR implementing three core services and a sophisticated AI orchestration layer. Demonstrates strong adherence to security best practices in most areas (streaming, constant-time auth, decimal math). Key issues include a bypassable command approval regex and a fragile custom cron parser.",
    "decision": "REQUEST_CHANGES"
  },
  "issues": [
    {
      "id": 1,
      "severity": "critical",
      "file": ".claude/hooks/auto-approve.sh",
      "line": 15,
      "title": "Bypassable Shell Metacharacter Regex",
      "description": "The regex `[\\&\\|\\;\\$\\>\\<\\`\\n]` used to detect dangerous shell characters is insufficient. It does not account for process substitution ` <(cmd)`, internal shell variables that don't start with `$`, or advanced redirection techniques. More importantly, it permits the use of characters like parentheses `()` if not immediately preceded by `$`, which can be used for subshells.",
      "suggestion": "Instead of 'enumerating badness', switch to a strict allow-list of characters for arguments or use a proper shell parser to tokenize the command before approval. At a minimum, include `(`, `)`, `{`, `}`, and `\\` in the forbidden set."
    },
    {
      "id": 2,
      "severity": "important",
      "file": "aegis/internal/backup/manager.go",
      "line": 450,
      "title": "Fragile Custom Cron Parser",
      "description": "The `calculateNextRun` function implements a custom cron parser that only handles basic `* * * * *` fields and a few aliases. It fails to support standard cron features like ranges (1-5), lists (1,2,3), or steps (*/5). This will lead to incorrect scheduling or errors when users attempt to use standard crontabs.",
      "suggestion": "Replace the custom logic with a robust, well-tested library like `github.com/robfig/cron/v3`. If a custom implementation is required, it must explicitly return an error for unsupported syntax instead of attempting to parse it incorrectly."
    },
    {
      "id": 3,
      "severity": "important",
      "file": "cerebra/pkg/config/config.go",
      "line": 45,
      "title": "Unescaped Credentials in Connection String",
      "description": "The PostgreSQL DSN is constructed using `fmt.Sprintf` with raw username and password strings. If a password contains reserved URI characters like `@`, `:`, or `/`, the resulting DSN will be malformed and the connection will fail.",
      "suggestion": "Use the `net/url` package to construct the DSN. Set the User field using `url.UserPassword(user, pass)` to ensure proper percent-encoding of credentials."
    },
    {
      "id": 4,
      "severity": "important",
      "file": "economist/pkg/cloud/aws.py",
      "line": 65,
      "title": "N+1 Network Calls for AWS Account ID",
      "description": "The `_get_account_id` method performs a call to `sts.get_caller_identity()` but does not appear to cache the result effectively across the collection lifecycle. In environments with many resources, this results in redundant network latency for every discovery operation.",
      "suggestion": "Implement a simple memoization pattern or class-level cache for the account ID, as it is immutable for the duration of the provider session."
    },
    {
      "id": 5,
      "severity": "suggestion",
      "file": "aegis/internal/backup/manager.go",
      "line": 210,
      "title": "Potential Disk Exhaustion in /tmp",
      "description": "The backup manager streams K8s resources to a temporary file in `/tmp` before encrypting and moving them to permanent storage. In containers with small root filesystems or memory-backed `/tmp`, large backups (e.g., many large Secrets/ConfigMaps) could cause disk exhaustion.",
      "suggestion": "Make the temporary directory path configurable via environment variable (e.g., `AEGIS_TEMP_PATH`) to allow users to mount a dedicated volume for backup staging."
    }
  ]
}
```