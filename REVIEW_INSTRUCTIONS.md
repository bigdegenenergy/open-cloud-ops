# ⚠️ REVIEW INSTRUCTIONS

> Generated by Gemini

```json
{
  "review": {
    "summary": "The PR implements a robust multi-service platform but introduces significant security risks via the automated configuration sync and shell-based workflow engine. Operational issues regarding state persistence and disk management in proxy logging must also be addressed.",
    "decision": "REQUEST_CHANGES"
  },
  "issues": [
    {
      "id": 1,
      "severity": "critical",
      "file": ".github/workflows/sync-claude-config.yml",
      "line": 1,
      "title": "High-risk supply chain dependency",
      "description": "The workflow automatically pulls and overwrites executable GitHub Workflows, shell scripts, and Python tools from an external repository ('bigdegenenergy/ai-dev-toolkit'). If the source repository is compromised, malicious code can be injected directly into the CI/CD pipeline and local hooks.",
      "suggestion": "Remove the automated sync of executable directories. Instead, treat the toolkit as a versioned dependency or use a 'pull-only' model where changes must be manually reviewed and approved in a PR that does not execute code from the source."
    },
    {
      "id": 2,
      "severity": "critical",
      "file": ".claude/workflows/lobster/engine.py",
      "line": 450,
      "title": "Remote command injection risk in workflow engine",
      "description": "The Lobster engine executes steps using `subprocess.run(..., shell=True)`. While variables are quoted using `shlex`, the command template itself is sourced from YAML definitions. In an agentic environment where LLMs or external 'Pulse' payloads can influence these definitions, this presents a significant injection surface.",
      "suggestion": "Refactor to use `shell=False` and pass arguments as a list. Avoid executing raw strings as shell commands."
    },
    {
      "id": 3,
      "severity": "important",
      "file": "cerebra/internal/proxy/handler.go",
      "line": 510,
      "title": "Unbounded disk spill leads to DoS",
      "description": "The `spillToDisk` function writes logs to `cerebra-log-spill.jsonl` when the async channel is full. There is no logic to check disk space, rotate the file, or limit its size. A persistent database outage or high-volume traffic spike could exhaust the host's disk space.",
      "suggestion": "Implement a maximum size limit for the spill file and use a rotating logger or a capped buffer. Add monitoring for the size of this spill file."
    },
    {
      "id": 4,
      "severity": "important",
      "file": "aegis/internal/backup/manager.go",
      "line": 45,
      "title": "In-memory persistence of backup schedules",
      "description": "The `BackupJobs` and `BackupRecords` are stored in standard Go maps. This state is lost on every service restart, meaning all user-defined backup schedules and historical tracking disappear unless the service is never restarted.",
      "suggestion": "Persist backup jobs and records to the PostgreSQL database on creation and update. Load the 'Jobs' map from the database during the BackupManager initialization."
    },
    {
      "id": 5,
      "severity": "important",
      "file": ".claude/hooks/auto-approve.sh",
      "line": 180,
      "title": "Fragile regex-based shell sanitization",
      "description": "The script attempts to detect 'dangerous' shell metacharacters using regex (`[;&|><$()]`). This is easily bypassed using alternatives like backslashes, newlines, or hex encoding depending on the shell environment.",
      "suggestion": "Avoid auto-approving any command that utilizes a shell. Only auto-approve specific, known-safe binaries with validated flag structures, and ideally avoid the use of a shell wrapper for these calls."
    },
    {
      "id": 6,
      "severity": "suggestion",
      "file": "economist/pkg/config.py",
      "line": 40,
      "title": "Potential credential exposure in logs",
      "description": "The Pydantic settings use standard `str` types for cloud secrets (AWS/Azure/GCP). These can be accidentally serialized into logs or error messages.",
      "suggestion": "Use Pydantic's `SecretStr` for all credentials. This ensures they are masked (e.g., '**********') when the model is printed or logged."
    },
    {
      "id": 7,
      "severity": "suggestion",
      "file": "cerebra/internal/router/router.go",
      "line": 285,
      "title": "Naive token estimation heuristic",
      "description": "The function `estimateTokenCount` uses a static `len(text) / 4`. This is highly inaccurate for non-English languages, code snippets, or structured data (JSON), which may lead to incorrect model routing decisions.",
      "suggestion": "Integrate a lightweight tokenizer (like tiktoken-go) or at least adjust the heuristic based on the detected character set (e.g., higher multipliers for CJK characters)."
    }
  ]
}
```